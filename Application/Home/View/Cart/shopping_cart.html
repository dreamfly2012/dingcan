



<include file="Public/header" title="{$store_config.store_title}" description="{$store_config.store_desc}"/>



<div class="header wthrough" style="background: none;">
<include file="Public/nav_header" />
</div>

<div class="container">
    <div>
        <div class="page-header">
            <h3>购物车</h3>
        </div>
        <form action="{:U('Cart/updateCart')}"  method="post">
        <table class="table table-hover table-striped table-bordered">
            <tbody>
                <tr> 
                    <th>
                        <input type="checkbox" class="check_all" id="check_all"/><label for="check_all" style="display: inline;">全选</label>
                    </th>
                    <th>商品</th>
                    <th>单价(元)</th>
                    <th>数量</th>
                    <th>小计(元)</th>
                    <th>操作</th>
                </tr>
                <foreach name="goods_list" item="goods">
                <tr>
                    <td>
                        <input type="checkbox" class="single_check"> <img src="/Uploads/{$goods.goods_thumb}" alt="">
                    </td>
                    <td>
                       {$goods.goods_name}
                    </td>
                    <td>
                        {$goods.goods_price}
                    </td>
                    <td>
                        <p>
                            <span class="icon-minus cart-minus"></span>
                            <input type="text" name="quantity[{$goods.goods_id}]" value="{$goods.goods_number}" data-recid="{$goods.rec_id}" class="cart-input" style="height: 27px;margin-top:10px;">
                            <span class="icon-plus cart-plus"></span>
                        </p>
                    </td>
                    <td>
                        <span class="sub_sum">{$goods.sub_total_price}</span>
                    </td>
                    <td>
                        <a href="javascript:;" class="delete_goods" data-id="{$goods.goods_id}">删除</a>
                    </td>
                </tr>
                </foreach>
                <tr>
                <td colspan="6">
                    <button type="submit" class="btn btn-success pull-left">更新购物车</button>
                    <a href="{:U('Order/checkout')}" class="btn btn-danger gray pull-right">结账</a></td>
                </tr>
            </tbody>
        </table>
        </form>
    </div>

    
</div>

<script type="text/javascript">
    $('.delete_goods').click(function(){
        var goods_id = $(this).attr('data-id');
        var __DELETE_CART_GOODS__ = "{:U('Cart/deleteGoods')}";
        $.ajax({
            url: __DELETE_CART_GOODS__,    
            data: {
                goods_id: goods_id,
            },
            type: 'post',
            dataType: 'json',
            success: function(data) {
                if (data.info == 1) {
                    alert('删除购物车商品成功');
                    window.reload();
                } else{
                    alert('删除购物车商品失败');
                }
            },
            error: function() {
                alert("网络异常！");
            }
        });
    });
</script>

<include file="Public/footer" />